{% extends "base.html" %}

{% block title %}{{ property.name }}{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>{{ property.name }}</h2>
        <div>
            <a class="btn btn-outline-primary" href="{% url 'rental_property_update' property.id %}">Edit</a>
            <a class="btn btn-outline-success" href="{% url 'rental_property_earnings' property.id %}">View Earnings</a>
            <a class="btn btn-outline-secondary" href="{% url 'rental_property_list' %}">Back</a>
        </div>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <p><strong>Address:</strong> {{ property.address }}</p>
            {% if property.website %}
                <p><strong>Website:</strong> <a href="{{ property.website }}" target="_blank" rel="noopener">{{ property.website }}</a></p>
            {% endif %}
            {% if property.agent %}
                <p><strong>Agent:</strong> {{ property.agent.name }}{% if property.agent.phone %} ({{ property.agent.phone }}){% endif %}{% if property.agent.email %} - {{ property.agent.email }}{% endif %}</p>
            {% endif %}
            <div class="row mb-3">
                <div class="col-md-4"><strong>Capital Value:</strong> {{ property.capital_value }}</div>
                <div class="col-md-4"><strong>Levies:</strong> {{ property.levies }}</div>
                <div class="col-md-4"><strong>Rates & Taxes:</strong> {{ property.rates_taxes }}</div>
                <div class="col-md-4"><strong>Water & Electricity:</strong> {{ property.water_electricity }}</div>
                <div class="col-md-4"><strong>Internet:</strong> {{ property.internet }}</div>
            </div>

            <div class="row mt-2">
                <div class="col-md-12 text-info"><strong>Rental Income:</strong> {{ property.flow_value }}</div>
                <div class="col-md-12 text-danger"><strong>Total Expenses:</strong> {{ property.total_expenses }}</div>
                <div class="col-md-12 fw-bold  text-success"><strong>Income:</strong> {{ property.income }}</div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mb-3">
        <div class="card-header">Images</div>
        <div class="card-body">
            <div class="row g-3 mb-3">
                {% for img in property.images.all %}
                    <div class="col-6 col-md-3">
                        <img src="{{ img.image.url }}" alt="{{ property.name }}" class="img-fluid rounded border">
                    </div>
                {% empty %}
                    <div class="text-muted">No images uploaded.</div>
                {% endfor %}
            </div>
            <form method="post" enctype="multipart/form-data" action="{% url 'rental_property_upload_image' property.id %}">
                {% csrf_token %}
                <div class="input-group">
                    {{ image_form.image }}
                    <button class="btn btn-sm btn-primary" type="submit">Upload</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header">
            Linked Invoices
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Customer</th>
                    <th>Issue Date</th>
                    <th>Status</th>
                    <th class="text-end">Total</th>
                </tr>
                </thead>
                <tbody>
                {% for inv in property.invoices.all %}
                    <tr>
                        <td><a href="{% url 'invoice_detail' inv.id %}">{{ inv.number }}</a></td>
                        <td>{{ inv.customer_name }}</td>
                        <td>{{ inv.issue_date }}</td>
                        <td>{{ inv.get_status_display }}</td>
                        <td class="text-end">{{ inv.total }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">No invoices linked.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}


